{% extends "base.html" %}
{% block content %}
<section class="search-hero card">
    <p class="eyebrow">å…¨ç«™æœç´¢</p>
    <h1>æ‰¾åˆ°ä»»ä½•æ–‡ç« ä¸ä½œè€…</h1>
    <p class="lead">è¾“å…¥å…³é”®å­—æˆ–é€‰æ‹©æ ‡ç­¾ï¼Œå¿«é€Ÿå®šä½æƒ³é˜…è¯»çš„æ–‡ç« ã€‚æ”¯æŒæ ‡é¢˜ã€æ­£æ–‡ä¸ä½œè€…æ˜µç§°æ¨¡ç³ŠåŒ¹é…ã€‚</p>
    <form class="search-form" method="get" action="/search">
        <div class="input-group">
            <label>å…³é”®å­—</label>
            <input type="search" name="q" placeholder="è¾“å…¥æ ‡é¢˜ã€æ­£æ–‡æˆ–ä½œè€…" value="{{ keyword }}">
        </div>
        <div class="input-group">
            <label>æ ‡ç­¾</label>
            <select name="tag">
                <option value="">å…¨éƒ¨</option>
                {% for cat in categories %}
                <option value="{{ cat.category }}" {% if tag == cat.category %}selected{% endif %}>
                    {{ cat.category }} ({{ cat.count }})
                </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit">å¼€å§‹æœç´¢</button>
    </form>
    {% if has_query %}
    <div class="search-info">
        <div class="stat">
            <span class="label">åŒ¹é…ç»“æœ</span>
            <span class="value">{{ result_count }}</span>
        </div>
        <div class="stat">
            <span class="label">å½“å‰ç­›é€‰</span>
            <span class="value">{{ keyword or tag or 'å…¨éƒ¨æ–‡ç« ' }}</span>
        </div>
    </div>
    {% endif %}
</section>

<section class="search-results-section">
    {% if not has_query %}
    <div class="empty-state">
        <p>è¾“å…¥å…³é”®è¯æˆ–é€‰æ‹©æ ‡ç­¾å³å¯æŸ¥çœ‹æœç´¢ç»“æœã€‚</p>
        <p class="hint">ä¾‹å¦‚ï¼šTCPã€ç›‘æ§ã€Socketã€æ”¶è—</p>
    </div>
    {% else %}
        {% if results %}
        <div class="search-results">
            {% for post in results %}
            <article class="search-hit">
                <div class="post-meta">
                    <span class="badge">{{ post.tags or 'æœªåˆ†ç±»' }}</span>
                    <span>{{ post.created_at }}</span>
                </div>
                <h3><a href="/posts/{{ post.id }}">{{ post.title }}</a></h3>
                <p>{{ post.body[:200] }}{% if post.body|length > 200 %}...{% endif %}</p>
                <div class="post-footer">
                    <div class="author">ä½œè€…ï¼š{{ post.author_name }}</div>
                    <div class="stats">
                        <span>ğŸ‘ {{ post.like_count }}</span>
                        <span>â­ {{ post.favorite_count }}</span>
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ç« ï¼Œå¯ä»¥å°è¯•å‡å°‘å…³é”®è¯æˆ–æ›´æ¢æ ‡ç­¾ã€‚</p>
            <a class="pill-btn" href="/posts/new">å»åˆ›ä½œå±äºä½ çš„å†…å®¹</a>
        </div>
        {% endif %}
    {% endif %}
</section>
{% endblock %}
